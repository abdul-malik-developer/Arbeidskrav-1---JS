<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arbeidskrav 1!</title>
    <link rel="stylesheet" href="game.css" />
  </head>
  <!-- HTML KODEN TRENGER DU IKKE RØRE FOR Å LØSE OPPGAVENE. -->

  <body>
    <div class="main-container">
      <!-- Healthbars til heroene -->
      <div class="hero-health-containers">
        <div class="healthbar-container">
          <!-- healer-health sin vidde må forandres for å endre lifebar -->
          <div id="henriette-currentHp" class="healthbar healer-health"></div>
          <div class="text-container">
            <p id="healer-name-txt">Henriette</p>
            <p id="healer-health-txt">400 / 400 HP</p>
          </div>
        </div>
        <div class="healthbar-container">
          <!-- archer-health sin vidde må forandres for å endre lifebar -->
          <div id="ariana-currentHp" class="healthbar archer-health"></div>
          <div class="text-container">
            <p id="archer-name-txt">Ariana</p>
            <p id="archer-health-txt">600 / 600 HP</p>
          </div>
        </div>
        <div class="healthbar-container">
          <!-- warrior-health sin vidde må forandres for å endre lifebar -->
          <div id="wyona-currentHp" class="healthbar warrior-health"></div>
          <div class="text-container">
            <p id="warrior-name-txt">Wyona</p>
            <p id="warrior-health-txt">800 / 800 HP</p>
          </div>
        </div>
      </div>

      <!-- Healthbar til fienden -->
      <div class="dragon-health-container">
        <div class="healthbar-container">
          <!-- dragon-health sin vidde må forandres for å endre lifebar -->
          <div id="daar-currentHP" class="healthbar dragon-health"></div>
          <div class="text-container">
            <p id="dragon-name-txt">Daar</p>
            <div id="dragon-health-txt" class="text-container dragon-health-txt">2000 / 2000 HP</div>
          </div>
        </div>
      </div>

      <!-- Bildecontainere for heroene -->
      <div class="img-container healer">
        <img class="hero" src="assets/healer.png" />
      </div>
      <div class="img-container archer">
        <img class="hero" src="assets/archer.png" />
      </div>
      <div class="img-container warrior">
        <img class="hero" src="assets/warrior.png" />
      </div>

      <!-- Bildecontainer for fienden -->
      <div class="enemy-container">
        <div class="img-container dragon-container">
          <img id="daar" class="dragon" src="assets/dragon.png" />
        </div>
      </div>
    </div>
    <script>
      //Denne JS-koden er laget klar for deg. Den trenger du ikke endre på.

      //Stats for heroes

      // const arianaImg = document.getElementById('ariana');
      const arianaImg = document.getElementsByClassName('hero')[0];
      const wyonaImg = document.getElementsByClassName('hero')[1];
      const henrietteImg = document.getElementsByClassName('hero')[2];

      let healthBars = document.getElementsByClassName('healthbar');
      let henrietteCurrentHP = healthBars[0];
      let arianaCurrentHP = healthBars[1];
      let wyonaCurrentHP = healthBars[2];



      let henrietteHealthTxt = document.getElementById('healer-health-txt');
      let arianalHealthTxt = document.getElementById('archer-health-txt');
      let wyonaHealthTxt = document.getElementById('warrior-health-txt');

      const daarImg = document.getElementById('daar');
      let daarCurrentHP = document.getElementById('daar-currentHP');
      let daarHealthTxt = document.getElementById('dragon-health-txt');


      const healthTxt = [henrietteHealthTxt, arianalHealthTxt, wyonaHealthTxt];
      const heroImg = [henrietteImg, arianaImg,wyonaImg];
      const healthColor = [henrietteCurrentHP,arianaCurrentHP,wyonaCurrentHP];


      let heroesArray = [
        {
          id: 0,
          name: "Henriette Healer",
          maxHP: 400,
          currentHP: 400,
          damage: 100,
          alive: true,
        },
        {
          id: 1,
          name: "Ariana archer",
          maxHP: 500,
          currentHP: 500,
          damage: 400,
          alive: true,
        },
        {
          id: 2,
          name: "Wyona Warrior",
          maxHP: 600,
          currentHP: 600,
          damage: 400,
          alive: true,
        },
      ];

      let dragonObject = {
        name: "Daar Dragon",
        maxHP: 2000,
        currentHP: 2000,
        damage: 200,
        alive: true,
      };

      henrietteImg.addEventListener('click', heroHenriette)
      arianaImg.addEventListener('click', heroAriana);
      wyonaImg.addEventListener('click', heroWyona);


      function heroAriana () {
        performAttack(1);
        dragonAttack();
      }

      function heroWyona () {
        performAttack(2);
        dragonAttack();
      }

      function heroHenriette () {
        performAttack(0);
        dragonAttack();
        healerBoost();
      }

      function performAttack (heroNum) {

      let {name,maxHP,currentHP,damage,alive } =  heroesArray[heroNum];
      
      alert(`${name} har gjort ${damage} skade på ${dragonObject.name}`);

      daarHealthTxt.textContent = `${dragonObject.currentHP -= damage} / 2000HP`;

      }

      function dragonAttack() {
      let randomIndex; 

      if(heroesArray.length > 1){
        randomIndex = Math.floor(Math.random() * heroesArray.length);
      } else {
        randomIndex = 0;
      }

      let {name,maxHP,currentHP,damage,alive } =  heroesArray[randomIndex];

      alert(`${dragonObject.name} har gjort ${dragonObject.damage} skade på ${name}`);

      if (alive) {
        currentHP -= dragonObject.damage;

        currentHP = Math.max (currentHP, 0);

        healthBarColor(randomIndex, currentHP, maxHP);

        if (currentHP === 0) {
          alive = false;
          heroImg[randomIndex].remove();
          healthTxt[randomIndex].parentNode.parentNode.remove();
          heroesArray = heroesArray.filter(hero => hero.alive);
        }
      }

      if (heroesArray === undefined){
        alert(`Spillet er tapt! ${dragonObject.name} har vunnet!`)
      }

      if (dragonObject.currentHP <=0){
        daarImg.remove()
        daarHealthTxt.parentNode.parentNode.remove();
        arianaImg.removeEventListener('click', heroAriana);
        wyonaImg.removeEventListener('click', heroWyona);
        henrietteImg.removeEventListener('click', heroHenriette);
        setTimeout(() =>{
          alert('Gratulerer, du har vunnet spillet!');
        }, 1500)
      }

      heroesArray[randomIndex] = { ...heroesArray[randomIndex], currentHP, alive };

    }

      function healerBoost() {
      heroesArray.forEach((hero,index) =>{
        if( hero.alive && hero.currentHP < hero.maxHP){
          hero.currentHP = Math.min(hero.currentHP + 100, hero.maxHP);
          healthTxt[index].textContent = `${hero.currentHP} / ${hero.maxHP} HP`;
          healthBarColor(index, hero.currentHP, hero.maxHP);
        }
      })
      }

      function healthBarColor(index, currentHP, maxHP) {
      healthTxt[index].textContent = `${currentHP} / ${maxHP} HP`;
      let heightPercentage = (currentHP / maxHP) * 100;
      let healthBars = document.getElementsByClassName('healthbar');
      let currentHealthBar = healthBars[index];
      const fixedHeight = 50;
      const heightInPixels = (heightPercentage / 100) * fixedHeight;
      currentHealthBar.style.height = `${heightInPixels}px`;
      }

    </script>
  </body>
</html>
